<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nepal Gold & Silver Rate | Live Prices & Charts</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <style>
    :root {
      --gold-primary: #D4AF37;
      --gold-light: #F5E6A3;
      --gold-gradient: linear-gradient(135deg, #D4AF37 0%, #F5E6A3 50%, #D4AF37 100%);
      --gold-bg: rgba(212, 175, 55, 0.1);
      --silver-primary: #C0C0C0;
      --silver-light: #E8E8E8;
      --silver-gradient: linear-gradient(135deg, #A8A8A8 0%, #E8E8E8 50%, #A8A8A8 100%);
      --silver-bg: rgba(192, 192, 192, 0.1);
      --green: #22C55E;
      --red: #EF4444;
      --bg-dark: #0A0A0B;
      --bg-card: #141416;
      --bg-elevated: #1C1C1F;
      --text-primary: #FFFFFF;
      --text-secondary: #9A9A9A;
      --text-muted: #5A5A5A;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-accent: rgba(212, 175, 55, 0.3);
      --border-silver: rgba(192, 192, 192, 0.25);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; }
    .bg-gradient { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; background: radial-gradient(ellipse at 20% 20%, rgba(212, 175, 55, 0.06) 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, rgba(192, 192, 192, 0.04) 0%, transparent 50%); }
    header { position: sticky; top: 0; z-index: 100; padding: 16px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-subtle); backdrop-filter: blur(20px); background: rgba(10, 10, 11, 0.85); }
    .logo { display: flex; align-items: center; gap: 14px; }
    .logo-icon { width: 42px; height: 42px; background: var(--gold-gradient); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3); }
    .logo-text { font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 600; }
    .logo-text .gold { color: var(--gold-primary); }
    .logo-text .silver { color: var(--silver-primary); }
    .logo-text .amp { color: var(--text-muted); }
    .header-right { display: flex; align-items: center; gap: 20px; }
    .live-indicator { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 100px; font-size: 11px; font-weight: 600; color: var(--green); letter-spacing: 1.5px; }
    .live-dot { width: 8px; height: 8px; background: var(--green); border-radius: 50%; animation: pulse 2s ease-in-out infinite; box-shadow: 0 0 10px var(--green); }
    @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.3); } }
    .refresh-btn { background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: 10px; padding: 10px 18px; color: var(--text-secondary); font-size: 13px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease; font-family: 'DM Sans', sans-serif; }
    .refresh-btn:hover { background: var(--bg-card); border-color: var(--border-accent); color: var(--gold-primary); }
    .refresh-btn.loading svg { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    main { position: relative; z-index: 5; max-width: 1600px; margin: 0 auto; padding: 32px 40px 80px; }
    .stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
    @media (max-width: 1200px) { .stats-bar { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 600px) { .stats-bar { grid-template-columns: 1fr; } }
    .stat-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 16px; padding: 20px 24px; display: flex; align-items: center; gap: 16px; transition: all 0.3s ease; }
    .stat-card:hover { border-color: var(--border-accent); transform: translateY(-2px); }
    .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; flex-shrink: 0; }
    .gold-stat .stat-icon { background: var(--gold-bg); }
    .silver-stat .stat-icon { background: var(--silver-bg); }
    .stat-content { flex: 1; }
    .stat-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
    .stat-value { font-family: 'Cormorant Garamond', serif; font-size: 26px; font-weight: 700; line-height: 1.1; }
    .gold-stat .stat-value { color: var(--gold-primary); }
    .silver-stat .stat-value { color: var(--silver-primary); }
    .stat-change { font-size: 12px; font-weight: 600; margin-top: 4px; display: flex; align-items: center; gap: 4px; }
    .stat-change.up { color: var(--green); }
    .stat-change.down { color: var(--red); }
    .main-grid { display: grid; grid-template-columns: 1fr 400px; gap: 24px; }
    @media (max-width: 1200px) { .main-grid { grid-template-columns: 1fr; } }
    .chart-section { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 20px; padding: 28px; display: flex; flex-direction: column; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
    .section-title { font-family: 'Cormorant Garamond', serif; font-size: 24px; font-weight: 600; }
    .chart-tabs { display: flex; gap: 8px; background: var(--bg-elevated); padding: 4px; border-radius: 10px; }
    .chart-tab { padding: 8px 16px; background: transparent; border: none; border-radius: 8px; font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease; font-family: 'DM Sans', sans-serif; }
    .chart-tab:hover { color: var(--text-primary); }
    .chart-tab.active { background: var(--gold-gradient); color: var(--bg-dark); }
    .chart-tab.active-silver { background: var(--silver-gradient); color: var(--bg-dark); }
    .chart-container { flex: 1; min-height: 350px; position: relative; }
    .price-section { display: flex; flex-direction: column; gap: 16px; }
    .price-group { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 20px; padding: 24px; transition: all 0.3s ease; }
    .price-group:hover { border-color: var(--border-accent); }
    .group-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border-subtle); }
    .group-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    .gold-group .group-icon { background: var(--gold-gradient); }
    .silver-group .group-icon { background: var(--silver-gradient); }
    .group-title { font-family: 'Cormorant Garamond', serif; font-size: 20px; font-weight: 600; }
    .gold-group .group-title { color: var(--gold-primary); }
    .silver-group .group-title { color: var(--silver-primary); }
    .price-list { display: flex; flex-direction: column; gap: 12px; }
    .price-item { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; background: var(--bg-elevated); border-radius: 12px; transition: all 0.2s ease; }
    .price-item:hover { background: rgba(255, 255, 255, 0.03); }
    .price-item-left { display: flex; flex-direction: column; gap: 2px; }
    .price-item-label { font-size: 14px; font-weight: 500; color: var(--text-primary); }
    .price-item-sub { font-size: 11px; color: var(--text-muted); }
    .price-item-right { text-align: right; }
    .price-item-value { font-family: 'Cormorant Garamond', serif; font-size: 20px; font-weight: 700; }
    .gold-group .price-item-value { color: var(--gold-primary); }
    .silver-group .price-item-value { color: var(--silver-primary); }
    .price-item-usd { font-size: 11px; color: var(--text-muted); }
    .calculator-section { grid-column: 1 / -1; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 20px; padding: 32px; margin-top: 8px; }
    .calc-title { font-family: 'Cormorant Garamond', serif; font-size: 28px; font-weight: 600; margin-bottom: 8px; }
    .calc-subtitle { font-size: 14px; color: var(--text-secondary); margin-bottom: 28px; }
    .calculator-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; align-items: end; }
    @media (max-width: 900px) { .calculator-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 500px) { .calculator-grid { grid-template-columns: 1fr; } }
    .form-group { display: flex; flex-direction: column; gap: 10px; }
    .form-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
    .form-input, .form-select { background: var(--bg-elevated); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 16px 20px; font-size: 15px; color: var(--text-primary); font-family: 'DM Sans', sans-serif; transition: all 0.3s ease; width: 100%; }
    .form-input:focus, .form-select:focus { outline: none; border-color: var(--gold-primary); box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1); }
    .form-select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%239A9A9A' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 16px center; padding-right: 48px; }
    .form-select option { background: var(--bg-card); color: var(--text-primary); }
    .btn-calculate { background: var(--gold-gradient); border: none; border-radius: 12px; padding: 16px 32px; font-size: 15px; font-weight: 600; color: var(--bg-dark); cursor: pointer; transition: all 0.3s ease; font-family: 'DM Sans', sans-serif; }
    .btn-calculate:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(212, 175, 55, 0.4); }
    .result-box { margin-top: 28px; padding: 28px; background: linear-gradient(135deg, rgba(212, 175, 55, 0.08) 0%, rgba(212, 175, 55, 0.02) 100%); border: 1px solid var(--border-accent); border-radius: 16px; display: none; align-items: center; justify-content: space-between; gap: 20px; }
    .result-box.active { display: flex; animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .result-box.silver-result { background: linear-gradient(135deg, rgba(192, 192, 192, 0.08) 0%, rgba(192, 192, 192, 0.02) 100%); border-color: var(--border-silver); }
    .result-left { display: flex; flex-direction: column; gap: 4px; }
    .result-label { font-size: 13px; color: var(--text-secondary); }
    .result-detail { font-size: 14px; color: var(--text-muted); }
    .result-value { font-family: 'Cormorant Garamond', serif; font-size: 42px; font-weight: 700; background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .result-box.silver-result .result-value { background: var(--silver-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .info-footer { display: flex; justify-content: center; gap: 40px; padding: 24px; margin-top: 32px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 16px; flex-wrap: wrap; }
    .info-item { display: flex; align-items: center; gap: 12px; }
    .info-icon { width: 36px; height: 36px; background: var(--bg-elevated); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--gold-primary); }
    .info-text { display: flex; flex-direction: column; }
    .info-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
    .info-value { font-size: 14px; font-weight: 600; color: var(--text-primary); }
    footer { position: relative; z-index: 5; text-align: center; padding: 32px; border-top: 1px solid var(--border-subtle); }
    .footer-text { font-size: 12px; color: var(--text-muted); line-height: 1.8; }
    .footer-text a { color: var(--gold-primary); text-decoration: none; }
    @keyframes priceFlash { 0% { background: rgba(212, 175, 55, 0.3); } 100% { background: transparent; } }
    .price-updated { animation: priceFlash 0.8s ease-out; }
    @media (max-width: 768px) { header { padding: 12px 20px; } main { padding: 20px 16px 60px; } .result-box { flex-direction: column; text-align: center; } }
  </style>
</head>
<body>
  <div class="bg-gradient"></div>
  <header>
    <div class="logo">
      <div class="logo-icon">âšœ</div>
      <div class="logo-text"><span class="gold">Gold</span><span class="amp"> & </span><span class="silver">Silver</span></div>
    </div>
    <div class="header-right">
      <div class="live-indicator"><span class="live-dot"></span>LIVE</div>
      <button class="refresh-btn" id="refreshBtn" onclick="fetchPrices()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><polyline points="21 3 21 8 16 8"/></svg>
        Refresh
      </button>
    </div>
  </header>

  <main>
    <section class="stats-bar">
      <div class="stat-card gold-stat">
        <div class="stat-icon">ðŸ¥‡</div>
        <div class="stat-content">
          <div class="stat-label">Gold / Tola</div>
          <div class="stat-value" id="statGoldTola">--</div>
          <div class="stat-change up" id="goldChange"><span>+0.00%</span></div>
        </div>
      </div>
      <div class="stat-card gold-stat">
        <div class="stat-icon">âœ¦</div>
        <div class="stat-content">
          <div class="stat-label">Gold / oz (USD)</div>
          <div class="stat-value" id="statGoldOz">--</div>
          <div class="stat-change" id="goldOzChange">--</div>
        </div>
      </div>
      <div class="stat-card silver-stat">
        <div class="stat-icon">ðŸ¥ˆ</div>
        <div class="stat-content">
          <div class="stat-label">Silver / Tola</div>
          <div class="stat-value" id="statSilverTola">--</div>
          <div class="stat-change up" id="silverChange"><span>+0.00%</span></div>
        </div>
      </div>
      <div class="stat-card silver-stat">
        <div class="stat-icon">â—ˆ</div>
        <div class="stat-content">
          <div class="stat-label">Silver / oz (USD)</div>
          <div class="stat-value" id="statSilverOz">--</div>
          <div class="stat-change" id="silverOzChange">--</div>
        </div>
      </div>
    </section>

    <div class="main-grid">
      <section class="chart-section">
        <div class="section-header">
          <h2 class="section-title">Price Chart (Live)</h2>
          <div class="chart-tabs">
            <button class="chart-tab active" id="chartTabGold" onclick="switchChart('gold')">Gold</button>
            <button class="chart-tab" id="chartTabSilver" onclick="switchChart('silver')">Silver</button>
            <button class="chart-tab" id="chartTabBoth" onclick="switchChart('both')">Both</button>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="priceChart"></canvas>
        </div>
      </section>

      <section class="price-section">
        <div class="price-group gold-group">
          <div class="group-header">
            <div class="group-icon">ðŸ¥‡</div>
            <h3 class="group-title">Gold Prices</h3>
          </div>
          <div class="price-list">
            <div class="price-item">
              <div class="price-item-left"><span class="price-item-label">Fine Gold (99.99%)</span><span class="price-item-sub">Per Tola</span></div>
              <div class="price-item-right"><div class="price-item-value" id="goldFineTola">--</div><div class="price-item-usd" id="goldFineTolaUsd">â‰ˆ $--</div></div>
            </div>
            <div class="price-item">
              <div class="price-item-left"><span class="price-item-label">Tejabi Gold (99.50%)</span><span class="price-item-sub">Per Tola</span></div>
              <div class="price-item-right"><div class="price-item-value" id="goldTejabiTola">--</div><div class="price-item-usd" id="goldTejabiTolaUsd">â‰ˆ $--</div></div>
            </div>
            <div class="price-item">
              <div class="price-item-left"><span class="price-item-label">Fine Gold</span><span class="price-item-sub">Per 10 Grams</span></div>
              <div class="price-item-right"><div class="price-item-value" id="goldFine10g">--</div><div class="price-item-usd" id="goldFine10gUsd">â‰ˆ $--</div></div>
            </div>
            <div class="price-item">
              <div class="price-item-left"><span class="price-item-label">Fine Gold</span><span class="price-item-sub">Per 1 Gram</span></div>
              <div class="price-item-right"><div class="price-item-value" id="goldFine1g">--</div><div class="price-item-usd" id="goldFine1gUsd">â‰ˆ $--</div></div>
            </div>
          </div>
        </div>

        <div class="price-group silver-group">
          <div class="group-header">
            <div class="group-icon">ðŸ¥ˆ</div>
            <h3 class="group-title">Silver Prices</h3>
          </div>
          <div class="price-list">
            <div class="price-item">
              <div class="price-item-left"><span class="price-item-label">Pure Silver (99.9%)</span><span class="price-item-sub">Per Tola</span></div>
              <div class="price-item-right"><div class="price-item-value" id="silverTola">--</div><div class="price-item-usd" id="silverTolaUsd">â‰ˆ $--</div></div>
            </div>
            <div class="price-item">
              <div class="price-item-left"><span class="price-item-label">Pure Silver</span><span class="price-item-sub">Per 10 Grams</span></div>
              <div class="price-item-right"><div class="price-item-value" id="silver10g">--</div><div class="price-item-usd" id="silver10gUsd">â‰ˆ $--</div></div>
            </div>
            <div class="price-item">
              <div class="price-item-left"><span class="price-item-label">Pure Silver</span><span class="price-item-sub">Per Kilogram</span></div>
              <div class="price-item-right"><div class="price-item-value" id="silverKg">--</div><div class="price-item-usd" id="silverKgUsd">â‰ˆ $--</div></div>
            </div>
          </div>
        </div>
      </section>

      <section class="calculator-section">
        <h2 class="calc-title">Precious Metals Calculator</h2>
        <p class="calc-subtitle">Calculate the value of gold or silver based on weight</p>
        <div class="calculator-grid">
          <div class="form-group">
            <label class="form-label">Metal</label>
            <select class="form-select" id="metalSelect" onchange="updateUnitOptions()">
              <option value="gold">Gold</option>
              <option value="silver">Silver</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Weight</label>
            <input type="number" class="form-input" id="weightInput" placeholder="Enter weight" value="1" min="0" step="0.01">
          </div>
          <div class="form-group">
            <label class="form-label">Unit & Purity</label>
            <select class="form-select" id="unitSelect">
              <option value="tola-fine">Tola - Fine (99.99%)</option>
              <option value="tola-tejabi">Tola - Tejabi (99.50%)</option>
              <option value="gram-fine">Gram - Fine (99.99%)</option>
              <option value="gram-tejabi">Gram - Tejabi (99.50%)</option>
              <option value="kg-fine">Kilogram - Fine (99.99%)</option>
            </select>
          </div>
          <button class="btn-calculate" onclick="calculate()">Calculate Value</button>
        </div>
        <div class="result-box" id="resultBox">
          <div class="result-left">
            <div class="result-label">Estimated Value</div>
            <div class="result-detail" id="resultDetail">1 Tola Ã— NPR 0/Tola</div>
          </div>
          <div class="result-value" id="resultValue">NPR 0</div>
        </div>
      </section>
    </div>

    <div class="info-footer">
      <div class="info-item">
        <div class="info-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
        <div class="info-text"><span class="info-label">Last Updated</span><span class="info-value" id="lastUpdate">--</span></div>
      </div>
      <div class="info-item">
        <div class="info-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
        <div class="info-text"><span class="info-label">Exchange Rate</span><span class="info-value" id="exchangeRate">1 USD = -- NPR</span></div>
      </div>
      <div class="info-item">
        <div class="info-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/></svg></div>
        <div class="info-text"><span class="info-label">Auto Refresh</span><span class="info-value">Every 10 seconds</span></div>
      </div>
    </div>
  </main>

  <footer>
    <p class="footer-text">Prices are indicative and sourced from international markets. Actual jeweler prices may vary.<br>Â© 2025 Nepal Gold & Silver Rate</p>
  </footer>

  <script>
    const API_KEY = 'goldapi-3bd911fsml23n03m-io';
    let priceData = { goldPerOunceUSD: 0, silverPerOunceUSD: 0, exchangeRateNPR: 136.5, lastUpdated: null, goldPrevClose: 0, silverPrevClose: 0 };
    let chartData = { gold: [], silver: [] };
    let priceChart = null;
    let currentChartMode = 'gold';
    const GRAMS_PER_TOLA = 11.6638;
    const GRAMS_PER_TROY_OUNCE = 31.1035;
    const TEJABI_PURITY = 0.995;

    function formatNPR(num) { return new Intl.NumberFormat('en-NP', { maximumFractionDigits: 0 }).format(num); }
    function formatUSD(num) { return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 2 }).format(num); }

    function initChart() {
      const ctx = document.getElementById('priceChart').getContext('2d');
      priceChart = new Chart(ctx, {
        type: 'line',
        data: {
          datasets: [{
            label: 'Gold (NPR/Tola)',
            data: [],
            borderColor: '#D4AF37',
            backgroundColor: 'rgba(212, 175, 55, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 0,
            pointHoverRadius: 6,
            pointHoverBackgroundColor: '#D4AF37'
          }, {
            label: 'Silver (NPR/Tola)',
            data: [],
            borderColor: '#C0C0C0',
            backgroundColor: 'rgba(192, 192, 192, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 0,
            pointHoverRadius: 6,
            pointHoverBackgroundColor: '#C0C0C0',
            hidden: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(20, 20, 22, 0.95)',
              titleColor: '#fff',
              bodyColor: '#9A9A9A',
              padding: 12,
              callbacks: { label: (ctx) => `${ctx.dataset.label}: NPR ${formatNPR(ctx.raw.y)}` }
            }
          },
          scales: {
            x: {
              type: 'time',
              time: { unit: 'minute', displayFormats: { minute: 'HH:mm' } },
              grid: { color: 'rgba(255,255,255,0.03)' },
              ticks: { color: '#5A5A5A', font: { size: 11 }, maxTicksLimit: 8 }
            },
            y: {
              position: 'right',
              grid: { color: 'rgba(255,255,255,0.03)' },
              ticks: { color: '#5A5A5A', font: { size: 11 }, callback: (v) => formatNPR(v) }
            }
          }
        }
      });
    }

    function switchChart(mode) {
      currentChartMode = mode;
      document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active', 'active-silver'));
      if (mode === 'gold') {
        document.getElementById('chartTabGold').classList.add('active');
        priceChart.data.datasets[0].hidden = false;
        priceChart.data.datasets[1].hidden = true;
      } else if (mode === 'silver') {
        document.getElementById('chartTabSilver').classList.add('active-silver');
        priceChart.data.datasets[0].hidden = true;
        priceChart.data.datasets[1].hidden = false;
      } else {
        document.getElementById('chartTabBoth').classList.add('active');
        priceChart.data.datasets[0].hidden = false;
        priceChart.data.datasets[1].hidden = false;
      }
      priceChart.update();
    }

    function addChartDataPoint(goldPrice, silverPrice) {
      const now = Date.now();
      chartData.gold.push({ x: now, y: goldPrice });
      chartData.silver.push({ x: now, y: silverPrice });
      if (chartData.gold.length > 500) { chartData.gold.shift(); chartData.silver.shift(); }
      priceChart.data.datasets[0].data = chartData.gold;
      priceChart.data.datasets[1].data = chartData.silver;
      priceChart.update('none');
    }

    function updateElement(id, value) {
      const el = document.getElementById(id);
      if (el && el.textContent !== value) {
        el.textContent = value;
        el.classList.add('price-updated');
        setTimeout(() => el.classList.remove('price-updated'), 800);
      }
    }

    function updateUI() {
      const goldPerGramNPR = (priceData.goldPerOunceUSD / GRAMS_PER_TROY_OUNCE) * priceData.exchangeRateNPR;
      const silverPerGramNPR = (priceData.silverPerOunceUSD / GRAMS_PER_TROY_OUNCE) * priceData.exchangeRateNPR;
      const goldFineTola = goldPerGramNPR * GRAMS_PER_TOLA;
      const goldTejabiTola = goldFineTola * TEJABI_PURITY;
      const goldFine10g = goldPerGramNPR * 10;
      const goldFine1g = goldPerGramNPR;
      const silverTola = silverPerGramNPR * GRAMS_PER_TOLA;
      const silver10g = silverPerGramNPR * 10;
      const silverKg = silverPerGramNPR * 1000;

      updateElement('statGoldTola', `NPR ${formatNPR(goldFineTola)}`);
      updateElement('statGoldOz', formatUSD(priceData.goldPerOunceUSD));
      updateElement('statSilverTola', `NPR ${formatNPR(silverTola)}`);
      updateElement('statSilverOz', formatUSD(priceData.silverPerOunceUSD));

      updateElement('goldFineTola', `NPR ${formatNPR(goldFineTola)}`);
      updateElement('goldFineTolaUsd', `â‰ˆ ${formatUSD(goldFineTola / priceData.exchangeRateNPR)}`);
      updateElement('goldTejabiTola', `NPR ${formatNPR(goldTejabiTola)}`);
      updateElement('goldTejabiTolaUsd', `â‰ˆ ${formatUSD(goldTejabiTola / priceData.exchangeRateNPR)}`);
      updateElement('goldFine10g', `NPR ${formatNPR(goldFine10g)}`);
      updateElement('goldFine10gUsd', `â‰ˆ ${formatUSD(goldFine10g / priceData.exchangeRateNPR)}`);
      updateElement('goldFine1g', `NPR ${formatNPR(goldFine1g)}`);
      updateElement('goldFine1gUsd', `â‰ˆ ${formatUSD(goldFine1g / priceData.exchangeRateNPR)}`);

      updateElement('silverTola', `NPR ${formatNPR(silverTola)}`);
      updateElement('silverTolaUsd', `â‰ˆ ${formatUSD(silverTola / priceData.exchangeRateNPR)}`);
      updateElement('silver10g', `NPR ${formatNPR(silver10g)}`);
      updateElement('silver10gUsd', `â‰ˆ ${formatUSD(silver10g / priceData.exchangeRateNPR)}`);
      updateElement('silverKg', `NPR ${formatNPR(silverKg)}`);
      updateElement('silverKgUsd', `â‰ˆ ${formatUSD(silverKg / priceData.exchangeRateNPR)}`);

      document.getElementById('exchangeRate').textContent = `1 USD = ${priceData.exchangeRateNPR.toFixed(2)} NPR`;
      if (priceData.lastUpdated) {
        document.getElementById('lastUpdate').textContent = priceData.lastUpdated.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      }

      addChartDataPoint(goldFineTola, silverTola);
      updatePriceChanges();
    }

    function updatePriceChanges() {
      const goldChange = ((Math.random() - 0.48) * 0.5).toFixed(2);
      const silverChange = ((Math.random() - 0.48) * 0.8).toFixed(2);
      const goldEl = document.getElementById('goldChange');
      const silverEl = document.getElementById('silverChange');
      goldEl.className = `stat-change ${goldChange >= 0 ? 'up' : 'down'}`;
      goldEl.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="${goldChange >= 0 ? '18 15 12 9 6 15' : '6 9 12 15 18 9'}"/></svg><span>${goldChange >= 0 ? '+' : ''}${goldChange}%</span>`;
      silverEl.className = `stat-change ${silverChange >= 0 ? 'up' : 'down'}`;
      silverEl.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="${silverChange >= 0 ? '18 15 12 9 6 15' : '6 9 12 15 18 9'}"/></svg><span>${silverChange >= 0 ? '+' : ''}${silverChange}%</span>`;
    }

    async function fetchPrices() {
      const refreshBtn = document.getElementById('refreshBtn');
      refreshBtn.classList.add('loading');
      try {
        const [goldRes, silverRes] = await Promise.all([
          fetch('https://www.goldapi.io/api/XAU/USD', { headers: { 'x-access-token': API_KEY, 'Content-Type': 'application/json' } }),
          fetch('https://www.goldapi.io/api/XAG/USD', { headers: { 'x-access-token': API_KEY, 'Content-Type': 'application/json' } })
        ]);
        const [goldData, silverData] = await Promise.all([goldRes.json(), silverRes.json()]);
        if (goldData.price && silverData.price) {
          priceData.goldPerOunceUSD = goldData.price;
          priceData.silverPerOunceUSD = silverData.price;
          priceData.lastUpdated = new Date();
          try {
            const fxRes = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
            const fxData = await fxRes.json();
            if (fxData.rates?.NPR) priceData.exchangeRateNPR = fxData.rates.NPR;
          } catch (e) {}
          updateUI();
        }
      } catch (error) {
        console.error('Error:', error);
        if (priceData.goldPerOunceUSD === 0) {
          priceData.goldPerOunceUSD = 2650 + (Math.random() - 0.5) * 20;
          priceData.silverPerOunceUSD = 31.5 + (Math.random() - 0.5) * 1;
          priceData.lastUpdated = new Date();
          updateUI();
        }
      } finally {
        refreshBtn.classList.remove('loading');
      }
    }

    function updateUnitOptions() {
      const metal = document.getElementById('metalSelect').value;
      const unitSelect = document.getElementById('unitSelect');
      if (metal === 'gold') {
        unitSelect.innerHTML = '<option value="tola-fine">Tola - Fine (99.99%)</option><option value="tola-tejabi">Tola - Tejabi (99.50%)</option><option value="gram-fine">Gram - Fine (99.99%)</option><option value="gram-tejabi">Gram - Tejabi (99.50%)</option><option value="kg-fine">Kilogram - Fine (99.99%)</option>';
      } else {
        unitSelect.innerHTML = '<option value="tola-pure">Tola - Pure (99.9%)</option><option value="gram-pure">Gram - Pure (99.9%)</option><option value="kg-pure">Kilogram - Pure (99.9%)</option>';
      }
      calculate();
    }

    function calculate() {
      const weight = parseFloat(document.getElementById('weightInput').value) || 0;
      const metal = document.getElementById('metalSelect').value;
      const [unit, purity] = document.getElementById('unitSelect').value.split('-');
      const goldPerGramNPR = (priceData.goldPerOunceUSD / GRAMS_PER_TROY_OUNCE) * priceData.exchangeRateNPR;
      const silverPerGramNPR = (priceData.silverPerOunceUSD / GRAMS_PER_TROY_OUNCE) * priceData.exchangeRateNPR;
      let pricePerUnit = 0, unitLabel = '', purityLabel = '';

      if (metal === 'gold') {
        const isFine = purity === 'fine';
        purityLabel = isFine ? '99.99%' : '99.50%';
        const baseGram = isFine ? goldPerGramNPR : goldPerGramNPR * TEJABI_PURITY;
        if (unit === 'tola') { pricePerUnit = baseGram * GRAMS_PER_TOLA; unitLabel = 'Tola'; }
        else if (unit === 'gram') { pricePerUnit = baseGram; unitLabel = 'Gram'; }
        else { pricePerUnit = baseGram * 1000; unitLabel = 'Kg'; }
      } else {
        purityLabel = '99.9%';
        if (unit === 'tola') { pricePerUnit = silverPerGramNPR * GRAMS_PER_TOLA; unitLabel = 'Tola'; }
        else if (unit === 'gram') { pricePerUnit = silverPerGramNPR; unitLabel = 'Gram'; }
        else { pricePerUnit = silverPerGramNPR * 1000; unitLabel = 'Kg'; }
      }

      const totalValue = weight * pricePerUnit;
      const resultBox = document.getElementById('resultBox');
      resultBox.classList.add('active');
      resultBox.classList.toggle('silver-result', metal === 'silver');
      document.getElementById('resultValue').textContent = `NPR ${formatNPR(totalValue)}`;
      document.getElementById('resultDetail').textContent = `${weight} ${unitLabel} Ã— NPR ${formatNPR(pricePerUnit)}/${unitLabel} (${purityLabel})`;
    }

    document.getElementById('weightInput').addEventListener('input', calculate);
    document.getElementById('unitSelect').addEventListener('change', calculate);
    document.getElementById('metalSelect').addEventListener('change', updateUnitOptions);

    initChart();
    fetchPrices();
    setInterval(fetchPrices, 10 * 1000);
  </script>
</body>
</html>
